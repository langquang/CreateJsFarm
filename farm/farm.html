<!DOCTYPE html>
<html>
<head>
    <title>EaselJS Example: Bitmap Text</title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <link href="assets/farmStyles.css" rel="stylesheet" type="text/css"/>

    <style>

        canvas {
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        #farmCanvas {
            border: 1px solid white;
        }
    </style>

    <!-- Note: All core EaselJS classes are listed here: -->
    <script type="text/javascript" src="../src/createjs/events/Event.js"></script>
    <script type="text/javascript" src="../src/createjs/events/EventDispatcher.js"></script>
    <script type="text/javascript" src="../src/createjs/utils/Proxy.js"></script>
    <script type="text/javascript" src="../src/preloadjs/AbstractLoader.js"></script>
    <script type="text/javascript" src="../src/preloadjs/LoadQueue.js"></script>
    <script type="text/javascript" src="../src/preloadjs/TagLoader.js"></script>
    <script type="text/javascript" src="../src/preloadjs/XHRLoader.js"></script>
    <script type="text/javascript" src="../src/createjs/utils/IndexOf.js"></script>
    <script type="text/javascript" src="../src/easeljs/utils/UID.js"></script>
    <script type="text/javascript" src="../src/easeljs/utils/Ticker.js"></script>
    <script type="text/javascript" src="../src/easeljs/geom/Matrix2D.js"></script>
    <script type="text/javascript" src="../src/easeljs/geom/Point.js"></script>
    <script type="text/javascript" src="../src/easeljs/geom/Rectangle.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Shadow.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/SpriteSheet.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Graphics.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/DisplayObject.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Container.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Stage.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Bitmap.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Sprite.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/BitmapAnimation.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/BitmapText.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Shape.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/Text.js"></script>
    <script type="text/javascript" src="../src/easeljs/display/DOMElement.js"></script>
    <script type="text/javascript" src="../src/easeljs/events/MouseEvent.js"></script>
    <script type="text/javascript" src="../src/easeljs/filters/Filter.js"></script>
    <script type="text/javascript" src="../src/easeljs/ui/ButtonHelper.js"></script>
    <script type="text/javascript" src="../src/easeljs/ui/Touch.js"></script>
    <script type="text/javascript" src="../src/easeljs/utils/SpriteSheetUtils.js"></script>
    <script type="text/javascript" src="../src/easeljs/utils/SpriteSheetBuilder.js"></script>

    <script type="text/javascript" src="../src/easeljs/filters/BlurFilter.js"></script>
    <script type="text/javascript" src="../src/easeljs/filters/ColorFilter.js"></script>
    <script type="text/javascript" src="../src/easeljs/filters/ColorMatrix.js"></script>
    <script type="text/javascript" src="../src/easeljs/filters/ColorMatrixFilter.js"></script>

    <script type="text/javascript" src="sylvester.src.js"></script>
    <script type="text/javascript" src="easeljs-NEXT.min.js"></script>
    <script type="text/javascript" src="Tween.js"></script>
    <script type="text/javascript" src="Ease.js"></script>

    <script type="text/javascript" src="HashTable.js"></script>
    <script type="text/javascript" src="IsoEntity.js"></script>
    <script type="text/javascript" src="Road.js"></script>
    <script type="text/javascript" src="Building.js"></script>
    <script type="text/javascript" src="Map.js"></script>
    <script type="text/javascript" src="Helper.js"></script>
    <script type="text/javascript" src="Cursor.js"></script>
    <script type="text/javascript" src="IsoState.js"></script>
    <script type="text/javascript" src="ShopItem.js"></script>
    <script type="text/javascript" src="DialogShop.js"></script>


    <!-- We also provide hosted minified versions of all CreateJS libraries.
      http://code.createjs.com -->

    <script>

        var gCanvas;
        var gStage;
        var fpsLabel;
        var loader;
        var stageLocLabel;
        var stageLocLabel2;
        var gBackground;
        // container
        var gGameContainer;
        var gGridContainer;
        var gRoadsContainer;
        var gIsoContainer;
        var gCursorsContainer;
        var gUIContainer;
        // instance
        var gIsoState;
        var gCanpan = true;
        var gCursor;
        var gShop;
        // constance
        var stageWidth, stageHeight;
        var gAnchorX = 2452;
        var gAnchorY = 856;


        function init() {
            //=================================== Stage =============================================
            //find canvas
            gCanvas = document.getElementById("farmCanvas");
            stageWidth = gCanvas.width;
            stageHeight = gCanvas.height;
            // create a new gStage and point it at our canvas:
            gStage = new createjs.Stage(gCanvas);
            // to get onMouseOver & onMouseOut events, we need to enable them on the gStage:
            gStage.enableMouseOver();
            // mousemove
            gStage.mouseMoveOutside = true;

            //====================================== gBackground ======================================
            gBackground = new createjs.Bitmap("assets/background.jpg");

            //===================================== container ========================================
            // layer 0 - Game
            gGameContainer = new createjs.Container();
            gStage.addChild(gGameContainer);
            // layer 1
            gGameContainer.addChild(gBackground);
            // layer 2
            gGridContainer = new createjs.Container();
            gGridContainer.x = gAnchorX;
            gGridContainer.y = gAnchorY;
            gGameContainer.addChild(gGridContainer);
            // layer 3
            gRoadsContainer = new createjs.Container();
            gRoadsContainer.x = gAnchorX;
            gRoadsContainer.y = gAnchorY;
            gGameContainer.addChild(gRoadsContainer);
            // layer 4
            gIsoContainer = new createjs.Container();
            gIsoContainer.x = gAnchorX;
            gIsoContainer.y = gAnchorY;
            gGameContainer.addChild(gIsoContainer);
            // layer 5
            gCursorsContainer = new createjs.Container();
            gCursorsContainer.x = gAnchorX;
            gCursorsContainer.y = gAnchorY;
            gGameContainer.addChild(gCursorsContainer);
            // layer 6 - UI
            gUIContainer = new createjs.Container();
            gStage.addChild(gUIContainer);

            // ==================================== Instance =========================================
//            gMap = new IsoMap();
            gCursor = new Cursor();
            gIsoState = new IsoState();
            gShop = new DialogShop();
            // ===================================  stats ============================================
            stageLocLabel = new createjs.Text("Test press, click, doubleclick, mouseover, and mouseout", "bold 14px Arial", "#000");
            stageLocLabel.x = 10;
            stageLocLabel.y = 5;
            stageLocLabel.outline = 4;
            gStage.addChild(stageLocLabel);

            var stageLocLabel2 = stageLocLabel.clone();
            stageLocLabel2.outline = false;
            stageLocLabel2.color = "#fff";
            gStage.addChild(stageLocLabel2);

            // add a text object to output the current FPS:
            fpsLabel = new createjs.Text("-- fps", "bold 14px Arial", "#FFF");
            gStage.addChild(fpsLabel);
            fpsLabel.x = 10;
            fpsLabel.y = 20;

            // start the tick and point it at the window so we can do some work before updating the gStage:
            createjs.Ticker.setFPS(60);
            createjs.Ticker.addEventListener("tick", tick);
            gStage.on("stagemousemove", function (evt) {
                stageLocLabel.text = "stage: " + evt.stageX + "," + evt.stageY + "\t\t";
                var screenP = stageToScreen(evt.stageX, evt.stageY);
                stageLocLabel.text += "screen: " + screenP.e(1) + "," + screenP.e(2) + "\t\t";
                var isoP = stageToIso(evt.stageX, evt.stageY);
                stageLocLabel.text += "iso: " + isoP.e(1) + "," + isoP.e(2) + "\t\t";
                var cell = stageToCell(evt.stageX, evt.stageY);
                stageLocLabel.text += "cell: " + cell.e(1) + "," + cell.e(2) + "\t\t";

                stageLocLabel2.text = stageLocLabel.text;

            });

            // =================================== Global Event ===========================================
            // attach mouse handlers directly to the source canvas.
            // better than calling from canvas tag for cross browser compatibility:
            gStage.addEventListener("stagemousemove", onGameMove);
            gStage.addEventListener("stagemousedown", onGameDown);
            gStage.addEventListener("stagemouseup", onGameUp);
            gStage.addEventListener("click", onGameclick);


            //======================================= TEST INIT =============================================
            gUIContainer.addChild(gShop);

        }

        function tick(event) {
            zorder(gIsoState.children);
            fpsLabel.text = Math.round(createjs.Ticker.getMeasuredFPS()) + " fps";
            gStage.update(event);
        }

        function onGameclick(evt) {
            gCursor.handleOnStageClick(evt);
        }

        function onGameMove(evt) {
            gIsoState.handleOnStageMove(evt);
            gCursor.handleOnStageMove(evt);
        }

        function onGameDown(evt) {
            gIsoState.handleOnStageMouseDown(evt);
            gCursor.handleOnStageMouseDown(evt);
        }

        function onGameUp(evt) {
            gIsoState.handleOnStageMouseUp(evt);
            gCursor.handleOnStageMouseUp(evt);
        }

        function showIBShop(visible){
            if( visible )
                gUIContainer.addChild(gShop);
            else
                gUIContainer.removeChild(gShop);
        }


    </script>
</head>
<body onload="init()">
<div id="loader"></div>
<header id="header" class="EaselJS">
</header>
<div id="content">
    <canvas id="farmCanvas" width="1028" height="768"></canvas>
</div>
</body>
</html>